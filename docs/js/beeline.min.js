/*
  Copyright 2014, Andrew Cantino and Nicholas Lum, all rights reserved.
*/
(function(){var e=[].slice;window.BeelineUtils={colorIsDark:function(e){var t,o,r,n,i;return i=parseInt(e.substring(1),16),n=255&i>>16,o=255&i>>8,t=255&i>>0,r=.2126*n+.7152*o+.0722*t,80>r},attachElement:function(e){var t;return t=document.getElementsByTagName("head")[0],t?t.appendChild(e):document.body.appendChild(e)},loadScript:function(e,t){var o;return null==t&&(t={}),o=document.createElement("SCRIPT"),o.setAttribute("type","text/javascript"),o.setAttribute("src",e+(t.reload?"?r="+Math.random():"")),this.attachElement(o),null!=t.loads&&null!=t.then?this.whenTrue(function(){return null!=window[t.loads]},t.then):void 0},loadCSS:function(e,t){var o;return null==t&&(t={}),o=document.createElement("LINK"),o.setAttribute("rel","stylesheet"),o.setAttribute("href",e),o.setAttribute("type","text/css"),o.setAttribute("media",t.media||"all"),this.attachElement(o)},removeCSS:function(e){var t,o,r,n,i;for(n=document.querySelectorAll("link[href='"+e+"']"),i=[],o=0,r=n.length;r>o;o++)t=n[o],i.push(t.parentNode.removeChild(t));return i},afterRender:function(e){var t,o=this;return t=function(){var t;try{return e.call(o)}catch(r){return t=r,BeelineUtils.log("Exception in afterRender",t,null!=t?t.stack:void 0)}},window.setTimeout(t,1)},log:function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],"undefined"!=typeof console?"function"==typeof console.log?console.log.apply(console,["BeeLine Reader: "].concat(e.call(t))):void 0:void 0},reload:function(e){return null==e&&(e=null),e&&e.preventDefault(),window.location.reload()},alert:function(e){return alert(e)},urlMatches:function(e){var t,o;return null!=(t=window.location)?null!=(o=t.href)?o.match(e):void 0:void 0},whenTrue:function(e,t){var o;return o=function(){return e()?t():(BeelineUtils.log("Condition hasn't matched, trying again in a moment..."),setTimeout(o,50))},o()},not:function(e){return function(){return!e()}}}}).call(this),/*
  Copyright 2014, Andrew Cantino and Nicholas Lum, all rights reserved.
*/
function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].slice,o=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};window.BeeLineReader=function(){function r(t,o){if(null==o&&(o={}),this._resizeHandler=e(this._resizeHandler,this),this.recolor=e(this.recolor,this),this.uncolor=e(this.uncolor,this),this.color=e(this.color,this),!t||t&&t.jquery)throw"A raw DOM Node is required when creating a BeeLineReader instance";this.node=t,this.options=o,this.listeners={},this.reflowNeeded=!0,this.colorCache={},this.tohexCache={},this.coloring=!1,this.abortCount=0,this.skipTags=o.skipTags||this.DEFAULT_SKIP_TAGS,this.browserIsCompatible()&&(this.options.handleResize&&this._setupResizeHandler(),this.options.colorImmediately&&BeelineUtils.afterRender(this.color))}return r.prototype.BEELINE_INDICATOR_CLASS="beeline-node",r.SKIP_COLOR_ATTRIBUTE="data-beeline-skip",r.prototype.DEFAULT_SKIP_TAGS=["svg","h1","h2","h3","h4"],r.prototype.NUM_COLORS=4,r.prototype.SPACE_REGEX=/^\s+$/,r.prototype.MIN_COLOR_WIDTH=100,r.prototype.WRAPPER_TYPE="beelinespan",r.THEMES={
 dark: ["#000000","#970000","#000000","#00057F","#FBFBFB"],
 fire: ["#000000","#C11B17","#000000","#C35817","#FBFBFB"],
 fire2:["#000000","#307D7E","#000000","#6AA121","#FBFBFB"],
 blues:["#000000","#0000FF","#000000","#840DD2","#FBFBFB"],
 gray1:["#000000","#222222","#000000","#222222","#FBFBFB"],
 gray2:["#000000","#333333","#000000","#333333","#FBFBFB"],
 gray3:["#000000","#444444","#000000","#444444","#FBFBFB"],
 gray4:["#000000","#555555","#000000","#555555","#FBFBFB"],
 gray5:["#000000","#666666","#000000","#666666","#FBFBFB"],
 gray6:["#000000","#777777","#000000","#777777","#FBFBFB"]
},r.DEFAULT_THEME="bright",r.THEME_ORDER=["bright","dark","blues","gray","inverted"],r.prototype.color=function(e){var o,n=this;return this.browserIsCompatible()?(o=function(){var o;return o=1<=arguments.length?t.call(arguments,0):[],n.trigger.apply(n,["afterColor"].concat(t.call(o))),e?e.apply(null,o):void 0},this.trigger("beforeColor"),"custom"===this.getTheme()?this._color(this.node,this.options.customColor1||r.THEMES.custom[0],this.options.customColor2||r.THEMES.custom[1],this.options.customColor3||r.THEMES.custom[2],this.options.customColor4||r.THEMES.custom[3],this.options.customBackground||r.THEMES.custom[4],o):this._color.apply(this,[this.node].concat(t.call(r.THEMES[this.getTheme()]),[o]))):"function"==typeof e?e():void 0},r.prototype.getTheme=function(){return this.options.theme&&r.THEMES[this.options.theme]&&this.options.theme||r.DEFAULT_THEME},r.prototype.setCustom=function(e,t,o,r,n){return this.options.theme="custom",this.options.customColor1=e,this.options.customColor2=t,this.options.customColor3=o,this.options.customColor4=r,this.options.customBackground=n},r.prototype.setOptions=function(e){var t,o,r;r=[];for(t in e)o=e[t],r.push(this.options[t]=o);return r},r.prototype.uncolor=function(){return this.trigger("beforeUncolor"),this._unwrap(this.node),this.options.skipBackgroundColor||this._revertBackground(this.node),this.colored=!1,this.reflowNeeded=!0},r.prototype.recolor=function(e){return this.browserIsCompatible()?(this.trigger("beforeRecolor"),this.reflowNeeded=!0,this.color(e)):"function"==typeof e?e():void 0},r.prototype.cleanup=function(){return this.alreadySetupResizeHandler&&window.removeEventListener("resize",this._resizeHandler,!1),this.trigger("afterCleanup")},r.prototype.bind=function(e,t,o){var r;return(r=this.listeners)[e]||(r[e]=[]),this.listeners[e].push([t,o||this])},r.prototype.trigger=function(){var e,o,r,n,i,s,l,a,u;for(n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],l=this.listeners[n]||[],u=[],i=0,s=l.length;s>i;i++)a=l[i],r=a[0],o=a[1],u.push(r.apply(o,e));return u},r.prototype.browserIsCompatible=function(){var e;return e=this._getInternetExplorerVersion(),-1===e||e>=9},r.prototype._getInternetExplorerVersion=function(){var e,t,o;return t=-1,"Microsoft Internet Explorer"===navigator.appName&&(o=navigator.userAgent,e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==e.exec(o)&&(t=parseFloat(RegExp.$1))),t},r.prototype._setupResizeHandler=function(){return this.alreadySetupResizeHandler?void 0:(this.alreadySetupResizeHandler=!0,window.addEventListener("resize",this._resizeHandler,!1))},r.prototype._resizeHandler=function(){var e=this;return this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){return BeelineUtils.log("re-coloring after resize"),e.resizeTimer=null,e.recolor()},500)},r.prototype._addClasses=function(e,o){return e.className=t.call(e.className.split(/\s+/)).concat([o]).join(" ")},r.prototype._removeClasses=function(e,t){var o,r;return r=e.className.split(/\s+/),e.className=function(){var e,n,i;for(i=[],e=0,n=r.length;n>e;e++)o=r[e],o.match(t)||i.push(o);return i}().join(" ")},r.prototype._color=function(e,t,o,r,n,i,s){var l=this;return this.abortCount++,BeelineUtils.whenTrue(function(){return!l.coloring},function(){var a,u;return e.hasChildNodes()?(l.coloring=!0,l.abortCount--,l.options.skipBackgroundColor||(e.style.backgroundColor&&!e.originalBackgroundColor&&(e.originalBackgroundColor=e.style.backgroundColor),e.style.backgroundColor=i),l._removeClasses(e,/^(beeline-colored-area|beeline-theme-\w+)$/g),l._addClasses(e,"beeline-colored-area beeline-theme-"+l.getTheme()),u=[],a={reflowNeeded:l.reflowNeeded,xlast:null,xfirst:null,line:[],thisColor:0,colorOne:t,colorTwo:o,colorThree:r,colorFour:n,reflowNeeded:l.reflowNeeded,rtl:"rtl"===(window.getComputedStyle(e,null).direction||"").toLowerCase()},a.xmin===a.xmax&&(a.xmax+=1),l._wrapAndColor(e,u,a),l._workOff(u,{abortable:!0,after:function(e){return e&&(l.trigger("coloringAborted"),BeelineUtils.log("aborted coloring")),l.reflowNeeded=!1,l.colored=!0,l.coloring=!1,s?s():void 0}})):s?s({error:"This node has no children"}):void 0})},r.prototype._wrapAndColor=function(e,t,n){var i,s,l,a=this;if(1===e.nodeType){if(e=e.firstChild){for(l=[];;){if(i=e.nextSibling,1===e.nodeType&&(s=e.nodeName.toLowerCase(),o.call(this.skipTags,s)>=0||"true"===e.getAttribute(r.SKIP_COLOR_ATTRIBUTE))||(e.className===this.BEELINE_INDICATOR_CLASS?this._colorNode(t,e,n):this._wrapAndColor(e,t,n)),!(e=i))break;l.push(void 0)}return l}}else if(3===e.nodeType)return t.push(function(){var o,r,i,s,l,u,h,c,d;if(l=e.length,c=e.parentNode,u=e.nodeValue,c&&l&&!a.SPACE_REGEX.test(u)){for(o="",r=d=0;l>=0?l>d:d>l;r=l>=0?++d:--d)h=u.charAt(r)," "===h||"\n"===h||"	"===h||"\r"===h?o+=h:(o&&(s=document.createTextNode(o),i=document.createElement(a.WRAPPER_TYPE),i.className=a.BEELINE_INDICATOR_CLASS,i.appendChild(s),c.insertBefore(i,e),a._colorNode(t,i,n)),o=h);return o&&(s=document.createTextNode(o),i=document.createElement(a.WRAPPER_TYPE),i.className=a.BEELINE_INDICATOR_CLASS,i.appendChild(s),c.insertBefore(i,e),a._colorNode(t,i,n)),c.removeChild(e)}})},r.prototype._colorNode=function(e,t,o){var r=this;return e.push(function(){var e,n,i,s,l,a,u,h,c,d,p,f;if(o.reflowNeeded?(u=t.getBoundingClientRect(),t.cachedBeeLineXRect=u):u=t.cachedBeeLineXRect||t.cachedBeeLineXRect(),h=u.left,null===o.xlast&&(o.xlast=h,o.xfirst=h),a=o.rtl?h-o.xlast>0:h-o.xlast<0){for(o.thisColor<2?(l=o.colorOne,s=o.colorTwo):(l=o.colorThree,s=o.colorFour),i=o.line[o.line.length-1][1],p=o.line,c=0,d=p.length;d>c;c++)f=p[c],e=f[0],n=f[1],e.style.color=o.rtl?r._getColor(o.thisColor,n,o.xfirst,i,s,l):r._getColor(o.thisColor,n,o.xfirst,i,l,s);o.thisColor+=1,o.thisColor%=r.NUM_COLORS,o.line=[],o.xfirst=h}return o.xlast=h,o.line.push([t,h])})},r.prototype._getColor=function(e,t,o,r,n,i){var s,l,a,u,h,c,d,p,f,g,m,C,_,T,E,y,v,B,b,w,x,N,R;switch(this.colorCache[n+i]?(R=this.colorCache[n+i],u=R[0],f=R[1],a=R[2],p=R[3],l=R[4],d=R[5]):(u=this._hexToR(i),f=this._hexToR(n),a=this._hexToG(i),p=this._hexToG(n),l=this._hexToB(i),d=this._hexToB(n),this.colorCache[n+i]=[u,f,a,p,l,d]),N=x=w=0,s=3.1415/(r-o),g=u-f,c=a-p,h=l-d,m=C=b=y=B=v=_=E=E=0,e){case 0:m=t-o,C=s*m,b=C-3.1415,E=Math.cos(b),E+=1,E/=2,B=g*E,B+=f,v=c*E,v+=p,_=h*E,_+=d,N=Math.round(B),x=Math.round(v),w=Math.round(_);break;case 1:m=t-o,C=s*m,y=C,T=Math.cos(y),T+=1,T/=2,B=g*T,B+=f,v=c*T,v+=p,_=h*T,_+=d,N=Math.round(B),x=Math.round(v),w=Math.round(_);break;case 2:m=t-o,C=s*m,b=C-3.1415,E=Math.cos(b),E+=1,E/=2,B=g*E,B+=f,v=c*E,v+=p,_=h*E,_+=d,N=Math.round(B),x=Math.round(v),w=Math.round(_);break;case 3:m=t-o,C=s*m,y=C,T=Math.cos(y),T+=1,T/=2,B=g*T,B+=f,v=c*T,v+=p,_=h*T,_+=d,N=Math.round(B),x=Math.round(v),w=Math.round(_);break;default:N=127,x=127,w=127}return this._rgbToHex(N,x,w)},r.prototype._rgbToHex=function(e,t,o){return"#"+this._toHex(e)+this._toHex(t)+this._toHex(o)},r.prototype._toHex=function(e){var t;if(!(t=this.tohexCache[e])){if(e=parseInt(e,10),isNaN(e))return"00";e=Math.max(0,Math.min(e,255)),t="0123456789ABCDEF".charAt((e-e%16)/16)+"0123456789ABCDEF".charAt(e%16),this.tohexCache[e]=t}return t},r.prototype._hexToR=function(e){return parseInt(this._cutHex(e).substring(0,2),16)},r.prototype._hexToG=function(e){return parseInt(this._cutHex(e).substring(2,4),16)},r.prototype._hexToB=function(e){return parseInt(this._cutHex(e).substring(4,6),16)},r.prototype._cutHex=function(e){return"#"===e.charAt(0)?e.substring(1,7):e},r.prototype._time=function(e,t){var o,r;return r=(new Date).getTime(),t(),o=(new Date).getTime(),BeelineUtils.log(""+e+" took "+(o-r)+"ms")},r.prototype._revertBackground=function(e){return e.style.backgroundColor=e.originalBackgroundColor||""},r.prototype._unwrap=function(e){var t,o,r,n,i,s,l,a,u,h;for(t=[],n=[],u=e.getElementsByClassName(this.BEELINE_INDICATOR_CLASS),i=0,l=u.length;l>i;i++)o=u[i],0===t.length||o===t[t.length-1].nextSibling?t.push(o):(n.push(t),t=[o]);for(t.length>0&&n.push(t),h=[],s=0,a=n.length;a>s;s++)r=n[s],h.push(this._mergeContents(r));return h},r.prototype._mergeContents=function(e){var t,o,r,n,i,s,l,a,u,h;for(o=e[0].parentNode,r="",n=0,s=e.length;s>n;n++)t=e[n],null!==(null!=(a=t.firstChild)?a.nodeValue:void 0)&&(r+=t.firstChild.nodeValue);for(o.replaceChild(document.createTextNode(r),e[0]),u=e.slice(1,e.length),h=[],i=0,l=u.length;l>i;i++)t=u[i],h.push(o.removeChild(t));return h},r.prototype._workOff=function(e,t){var o,r,n=this;for(null==t&&(t={}),r=(new Date).getTime();(new Date).getTime()-r<20&&(o=e.shift());)o();if(e.length>0&&t.abortable&&this.abortCount>0){if(t.after)return t.after(!0)}else{if(e.length>0)return BeelineUtils.afterRender(function(){return n._workOff(e,t)});if(t.after)return t.after()}},r}()}.call(this);
